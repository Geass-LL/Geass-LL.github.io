---
layout: post
date: 2023-12-29 16:00:00 +0800
category: kernel
title: "关于cgroup"
---

## cgroup V2接口

<https://zorrozou.github.io/docs/%E8%AF%A6%E8%A7%A3Cgroup%20V2.html>

### cgroup V2在内核接口的升级

<https://www.infoq.cn/article/hbqqfeyqxzhnes5jipqt>

1. 新增`cgroup.controllers`：当前cgroup可以配置的子系统
2. 新增`cgroup.subtree_control`：当前cgroup的子目录默认继承的子系统，显然subtree_control应该是controllers的子集


## PSI

<https://www.cnblogs.com/Linux-tech/p/12961296.html>

全局的PSI值：`/proc/pressure`，per cgroup的PSI值：`/sys/fs/cgroup/{cpu.pressure, io.pressure, memory.pressure}`

/proc/pressure/cpu的full行是没有意义的，在5.13内核前不存在该行。后来内核更新新增了该行，并将full行的内容设置为全0。

* `some`：至少有一个任务阻塞在某个资源上的时间占比。
* `full`：所有非idle任务都阻塞在某个资源上的时间占比，此时CPU资源将完全浪费。

每个CPU的PSI状态如下：

|PSI状态|描述|
|-|-|
|PSI_IO_SOME|至少存在一个任务处于iowait状态|
|PSI_IO_FULL|CPU上至少存在一个任务处于iowait状态，并且该CPU没有可执行的程序，进入了idle状态|
|PSI_MEM_SOME|类似，处于memory stall状态|
|PSI_MEM_FULL|类似|
|PSI_CPU_SOME|该CPU至少有一个任务在等待调度|
|PSI_NONIDLE|CPU并非处于完全空闲状态。即：没有任务在等待IO、等待MEM、或者CPU|


